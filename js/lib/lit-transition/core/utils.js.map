{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/core/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  NodePart,\n  TemplateResult\n} from 'lit-html';\nimport classList from './class-list.js';\n\nexport function nextFrame(n = 1):Promise<void> {\n  return new Promise(resolve => \n    --n === 0 ? requestAnimationFrame(() => resolve()) :\n      resolve(nextFrame(n)));\n}\n\n/**\n * get parent skipping over fragments\n * @param elem input element\n */\nfunction parentElement(elem:HTMLElement):HTMLElement|null {\n  let e = elem;\n  while(e = (e.parentNode || (e as any).host)) {\n    if(e instanceof HTMLElement) {\n      return e;\n    }\n  }\n  return null;\n}\n\n/**\n * resolves once the class attribute of a node\n * has been consolidated\n * @param node DOMNode\n */\nexport function classChanged(node:HTMLElement, cb:Function|null, skipFrame:Boolean = true)Â {\n  return new Promise(resolve => {\n    // Create an observer instance linked to the callback function\n    const observer = new MutationObserver(async () => {\n      // Later, you can stop observing\n      observer.disconnect();\n      skipFrame && await nextFrame();\n      resolve();\n    });\n    // Start observing the target node for configured mutations\n    observer.observe(node, {\n      attributes: true,\n      attributeFilter: [\"class\"]\n    });\n    cb && cb();\n  });\n}\n\n/**\n * returns true on ignore dom nodes\n * @param dom \n */\nfunction ignoredDom(dom:HTMLElement) {\n  return dom.nodeName === '#text' && !(dom.nodeValue?.trim());\n}\n\nfunction partNodes(part:NodePart) {\n  const collected = [];\n  let node:any = part.startNode.nextSibling;\n  while(node !== part.endNode) {\n    collected.push(node);\n    node = node.nextSibling;\n  }\n  return collected;\n} \n\nexport function partDomSingle(part:NodePart):any {\n  let nodes:Array<any> = partNodes(part);\n  let active = nodes.filter(d => !ignoredDom(d));\n  // check part has a shape we accept\n  // (i.e. only one non-text node)\n  if(active.length != 1) {\n    throw new Error(\n      `lit-transition directive expects exactly one child node,\n      but was passed ${active.map(a => a.nodeName).join(', ')}`)\n  }\n  return active[0];\n}\n\n/**\n * marked templates are kept in a global weak map\n */\nconst markedTemplates = new WeakMap<TemplateResult,String>();\nexport function mark(templateResult:TemplateResult, name:String) {\n  markedTemplates.set(templateResult, name);\n  return templateResult;\n}\n\nexport function marked(templateResult:TemplateResult) {\n  return markedTemplates.get(templateResult);\n}\n\n/**\n * tries to figure out if the geometry of an object\n * should be locked. will return true if e will have\n * position: absolute and parent has position: relative;\n * @param e element\n * @param activeCass className that would be applied\n */\nexport function needsLock(e:HTMLElement, activeClass:string) {\n  const parent = parentElement(e);\n  if(parent) {\n    // createa a div with active class to peek if\n    // it will be positioned relatively;\n    const position = (() => {\n      const div = document.createElement('div');\n      const cl = classList(div);\n      // remove not needed since we detach child alltogether\n      const add = (c:any) => Array.isArray(c) ?\n        c.forEach((i:string) => cl.add(i)) : cl.add(c);\n      // use shadowRoot for peeking if available!\n      const root = parent.shadowRoot || parent;\n      add(activeClass);\n      root.appendChild(div);\n      const style = window.getComputedStyle(div);\n      const position = style.position;\n      // peeking done remove child\n      root.removeChild(div);\n      return position;\n    })()\n    if(position === 'absolute') {\n      const style = window.getComputedStyle(parent);\n      return style.position === 'relative';\n    }\n  }\n  return false;\n}\n\n/**\n * records geometry of a dom node so it can\n * be reaplied later on\n */\nexport function recordExtents(e:any) {\n  const rect = e.getBoundingClientRect();\n  // // we separately track margins\n  // // so in case the changed when the extents\n  // // are reapplied (like when a fixed margin is used)\n  // // we can compensate\n  // const style = window.getComputedStyle(e);\n  // const marginTop = parseFloat(style.marginTop) || 0;\n  // const marginLeft = parseFloat(style.marginLeft) || 0;\n  let top = 0; //-marginTop;\n  let left = 0; // -marginLeft;\n  {\n    let offsetParent:Element|null = e.offsetParent;\n    while(e && e !== document && !(e instanceof DocumentFragment)) {\n      if(e === offsetParent) {\n        break;\n      }\n      // not accounting for margins here\n      // since in case of margin: auto, offset\n      // may actually be the auto margin\n      // const style = window.getComputedStyle(e);\n      top += e.offsetTop - (e.scrollTop || 0);\n      left += e.offsetLeft - (e.scrollLeft || 0);\n      e = parentElement(e);\n    } \n  }\n  return {\n    left,\n    top,\n    width: rect.width,\n    height: rect.height\n  }\n}\n\n/**\n * applies left,top,width and height form ext\n * also sets marginLeft+Top to 0\n * @param e HTMLElement to apply extents to\n * @param ext extents object\n */\nexport function applyExtents(e:HTMLElement, ext:any) {\n  e.style.marginLeft = '0px';\n  e.style.marginTop = '0px';\n  e.style.left = (ext.left) + 'px';\n  e.style.top = (ext.top) + 'px';\n  e.style.width = (ext.width) + 'px';\n  e.style.height = (ext.height) + 'px';\n}\n\n\nlet _visible:Boolean;\nfunction updatePageVisibility(visible = !document.hidden){\n  _visible = visible;\n}\nupdatePageVisibility();\ndocument.addEventListener('visibilitychange', () => updatePageVisibility(), false);\n\nif(process.env.DEBUG) {\n  // @ts-ignore\n  window.updatePageVisibility = updatePageVisibility;\n}\n  \nexport function pageVisible():Boolean {\n  return _visible;\n}"]}